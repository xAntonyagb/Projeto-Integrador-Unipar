<div class="overlay">
  <div class="modal-container">
    <div class="modal-header">
      <a (click)="closeModal()">
        <img src="assets/Voltar.png">
      </a>
      <h2>Cadastro De Ordem De Serviço</h2>
    </div>

    <div class="modal-body">
      <div class="form-row">
        <div class="desc-part col-8">
          <label for="descricao">Descrição:</label>
          <input id="descricao" type="text" class="form-control" [(ngModel)]="descricaoOrdem" required>
        </div>
        <div class="data-part col-4">
          <label for="data">Data:</label>
          <input id="data" type="date" class="form-control" [(ngModel)]="data" required>
        </div>
      </div>
      <div class="modal-body" *ngFor="let ambienteGroup of ambientesComServicos; let i = index">
        <div class="form-row">
          <label for="ambiente-selecao-{{i}}">Selecionar Ambiente:</label>
          <select
            id="ambiente-selecao-{{i}}"
            class="form-control"
            [(ngModel)]="ambienteGroup.ambiente"
            [compareWith]="comparaAmbientes"
            required>
            <option value="" disabled selected>Selecione um ambiente</option>
            <option *ngFor="let ambiente of ambientesDisponiveis" [ngValue]="ambiente">
              {{ ambiente.descricao }}
            </option>
          </select>
        </div>
      
        <fieldset *ngFor="let servico of ambienteGroup.servicos; let j = index">
          <!-- Categoria -->
          <div class="form-row">
            <div class="desc-part col-8">
              <label for="servicoDescricao-{{i}}">Serviço:</label>
              <input id="servicoDescricao-{{i}}" type="text" class="form-control">
            </div>
            <div class="data-part col-4">
              <label for="categoria-{{i}}">Categoria:</label>
              <select id="categoria-{{i}}" class="form-control" [(ngModel)]="servico.categoria.id" required>
                <option *ngFor="let categoria of categoriasSelecionadas" [value]="categoria.id">
                  {{ categoria.descricao }}
                </option>
              </select>
            </div>
          </div>
          <!-- Valores -->
          <div class="form-row">
            <div class="desc-part col-4">
              <label for="quantidade-{{i}}">Quantidade:</label>
              <input id="quantidade-{{i}}-{{j}}" type="number" class="form-control" [(ngModel)]="servico.quantidade" (change)="onQuantidadeChange($event, i, j)">
            </div>
            <div class="data-part col-4">
              <label for="valor-{{i}}">Valor Unitário:</label>
              <input id="valor-{{i}}-{{j}}" type="number" class="form-control" [(ngModel)]="servico.valorUnit" (input)="onValorChange($event, i, j)">
            </div>
            <div class="data-part col-4">
              <label>Subtotal:</label>
              <input type="number" class="form-control" [value]="servico.valorTotal" readonly>
            </div>
          </div>
          <!-- Remover -->
          <img src="assets/Vector.svg" class="removerServico" *ngIf="j > 0" (click)="removerServico(i, j)" />
        </fieldset>

        <div class="modal-footer">
          <button (click)="adicionarServico(i)" class="btn btn-primary">Adicionar Serviço</button>
        </div>
      </div>
      <div class="form-row" style="text-align: center;">
        <button class="btn btn-primary" (click)="adicionarNovoAmbiente()">Adicionar Novo Ambiente</button>
      </div>

      <div class="modal-footer">
        <button (click)="guardarOrdem()" class="btn btn-success">Cadastrar</button>
        <div class="total-value">Total: {{ total | currency:'BRL' }}</div>
      </div>
    </div>
  </div>
</div>
